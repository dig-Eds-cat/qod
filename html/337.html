<!DOCTYPE html>
<html>
    <head>
        <title>MEGAdigital. Online-Angebot der historisch-kritischen Gesamtausgabe von Karl Marx und Friedrich Engels - MEGAdigital</title>
        <link rel="icon" href="https://megadigital.bbaw.de/resources/images/favicon.png" type="image/png">
        <link rel="stylesheet" type="text/css" href="https://megadigital.bbaw.de/resources/css/reset.css">
        <link rel="stylesheet" type="text/css" href="https://megadigital.bbaw.de/resources/css/960.css">
        <link rel="stylesheet" type="text/css" href="https://megadigital.bbaw.de/resources/css/main.css">
        <link rel="stylesheet" type="text/css" href="https://megadigital.bbaw.de/resources/css/jquery-ui.css">
        <link rel="stylesheet" type="text/css" href="https://megadigital.bbaw.de/resources/fontawesome-5.7.2/css/all.min.css">
        <link rel="stylesheet" type="text/css" href="https://megadigital.bbaw.de/resources/css/startseite.css">
        <link rel="stylesheet" media="screen,projection" href="https://megadigital.bbaw.de/resources/css/ui.totop.css">
        <script type="text/javascript" src="https://megadigital.bbaw.de/resources/js/MathJax.js"></script>
        <script type="text/javascript" id="MathJax-script" async="" src="https://megadigital.bbaw.de/resources/js/mml-chtml.js"></script>
        <script src="https://megadigital.bbaw.de/resources/js/jquery-3.5.1.min.js" type="text/javascript"></script>
        <script src="https://megadigital.bbaw.de/resources/js/jquery.collapser.min.js" type="text/javascript"></script>
        <script src="https://megadigital.bbaw.de/resources/js/jquery-ui.min.js" type="text/javascript"></script>
        <script type="text/javascript">
                    var _paq = _paq || [];
                    _paq.push(["setVisitorCookieTimeout", "604800"]);
                    _paq.push(["setSessionCookieTimeout", "0"]);
                    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
                    _paq.push(['trackPageView']);
                    _paq.push(['enableLinkTracking']);
                    (function() {
                    var u="https://piwik.bbaw.de/";
                    _paq.push(['setTrackerUrl', u+'piwik.php']);
                    _paq.push(['setSiteId', '31']);
                    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
                    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
                    })();
                </script>
        <script src="https://megadigital.bbaw.de/resources/js/bootstrap.min.js"> </script>
        <script src="https://megadigital.bbaw.de/resources/js/jquery.collapser.min.js"> </script>
        <noscript><img src="https://piwik.bbaw.de/piwik.php?idsite=31&amp;rec=1" style="border:0" alt=""></noscript>
    </head>
    <body>
        <div class="outerLayer" id="navbar">
            <div class="container_16">
                <div class="grid_4"><a id="homelink" href="https://megadigital.bbaw.de/index.xql">
                        <h1>MEGAdigital</h1></a></div>
                <div class="grid_12">
                    <nav id="nav">
                        <ul>
                            <li><a href="http://telota.bbaw.de/mega/">Kapital <i class="fas fa-external-link-square-alt" style="margin-left: .2em;"></i></a></li>
                            <li><a href="https://megadigital.bbaw.de/briefe/index.xql">Briefe</a>
                                <ul>
                                    <li><a href="https://megadigital.bbaw.de/briefe/index.xql?jahr=1866">Jahrgang 1866</a></li>
                                    <li><a href="https://megadigital.bbaw.de/briefe/index.xql?jahr=1867">Jahrgang 1867</a></li>
                                    <li><a href="https://megadigital.bbaw.de/briefe/index.xql?jahr=1868">Jahrgang 1868</a></li>
                                    <li><a href="https://megadigital.bbaw.de/briefe/index.xql?jahr=1869">Jahrgang 1869</a></li>
                                    <li><a href="https://megadigital.bbaw.de/briefe/index.xql?jahr=1870">Jahrgang 1870</a></li>
                                </ul>
                            </li>
                            <li><a href="https://megadigital.bbaw.de/exzerpte/index.xql">Exzerpte</a>
                                <ul>
                                    <li><a href="https://megadigital.bbaw.de/exzerpte/index.xql?band=IV-19#IV-19">MEGA IV/19: Polit. Ökonomie, Geldmarkt, Krisen (1868–1872)</a></li>
                                    <li><a href="https://megadigital.bbaw.de/exzerpte/index.xql?band=IV-25#IV-25">MEGA IV/25: Polit. Ökonomie, Geld- und Kreditwesen, Krisen (1876–1879)</a></li>
                                    <li><a href="https://megadigital.bbaw.de/exzerpte/index.xql?band=IV-27#IV-27">MEGA IV/27: Frühgeschichte, Gemeindelandbesitz, Ethnologie (1879–1882)</a></li>
                                </ul>
                            </li>
                            <li><a href="https://megadigital.bbaw.de/register/index.xql">Register</a></li>
                            <li><a href="https://megadigital.bbaw.de/about/text.xql?id=M0001265">Editorische Hinweise</a></li>
                            <li><a class="search" href="https://megadigital.bbaw.de/suche/index.xql"><span>Suche</span></a></li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
        <div class="outerLayer" id="header">
            <header class="container_16">
                <div class="grid_16">
                    <h1>MEGAdigital</h1>
                    <p>Online-Abteilung der historisch-kritischen Gesamtausgabe von Karl Marx und Friedrich Engels</p>
                    <p>Herausgegeben von der Internationalen Marx-Engels-Stiftung (IMES)</p>
                </div>
            </header>
        </div>
        <div class="contentLayer " id="content">
            <div class="container_12">
                <div class="grid_4 teaser-img"><a href="http://telota.bbaw.de/mega/" title="Online verfügbare Inhalte der II. Abteilung"><img class="img-homepage" src="resources/images/teaser_kapital.jpg"></a><span class="serviceinfo" id="info-homepage"><i class="fa fa-info-circle"></i><span>Karl Marx: Aus den Manuskripten zum Kapital. (Mit redaktionellen Vermerken von Friedrich Engels.), IISG, Amsterdam</span></span>
                    <div id="teaser-kapital"><a href="http://telota.bbaw.de/mega/" title="Online verfügbare Inhalte der II. Abteilung">
                            <h3>„Das Kapital“ und Vorarbeiten</h3></a></div>
                </div>
                <div class="grid_4 toc teaser-img"><a href="briefe/index.xql" title="Übersicht aller online verfügbaren Briefe"><img class="img-homepage" src="resources/images/teaser_brief_speyer.jpg"></a><span class="serviceinfo" id="info-homepage"><i class="fa fa-info-circle"></i><span>Karl Speyer an Karl Marx in London. London, Sonntag, 17. Mai 1868, RGASPI, Sign. f. 21 op. 1 d. 24/2</span></span>
                    <div id="teaser-brief"><a href="briefe/index.xql" title="Übersicht aller online verfügbaren Briefe">
                            <h3>Briefwechsel (ab 1866)</h3></a><!--<ul >
                        <li><a
                            href="briefe/index.xql?jahr=1866"
                            title="Briefe des Jahres 1866">1866</a>&#160; | &#160;<a
                            href="about/text.xql?id=M0004866"
                            title="Einführung zum Briefjahrgang 1866">Einleitung</a></li>
                        <li><a
                            href="briefe/index.xql?jahr=1867"
                            title="Briefe des Jahres 1867">1867</a>&#160; | &#160;<a
                            href="about/text.xql?id=M0004864"
                            title="Einführung zum Briefjahrgang 1867">Einleitung</a></li>
                        <li><a
                            href="briefe/index.xql?jahr=1868"
                            title="Briefe des Jahres 1868">1868</a>&#160; | &#160;<a
                            href="about/text.xql?id=M0005003"
                            title="Einführung zum Briefjahrgang 1868">Einleitung</a></li>
                        <li><a
                            href="briefe/index.xql?jahr=1869"
                            title="Briefe des Jahres 1869">1869</a>&#160; | &#160;<a
                            href="about/text.xql?id=M3622620"
                            title="Einführung zum Briefjahrgang 1869">Einleitung</a></li>
                    </ul>--></div>
                </div>
                <div class="grid_4 toc teaser-img" id=""><a href="exzerpte/index.xql" title="Exzerpte und Notizen"><img class="img-homepage" src="resources/images/teaser_exzerpte.jpg"></a><span class="serviceinfo" id="info-homepage"><i class="fa fa-info-circle"></i><span>IISG, Marx-Engels-Nachlass, Sign. B84/B83. S. [37]. Das Heft hat Marx betitelt als "Book of the Crisis of 1857". Es ist in MEGA IV/14 veröffentlicht. Die Manuskriptseite ist dort S. 166-169 entziffert/ediert.</span></span>
                    <div id="teaser-exzerpte"><a href="exzerpte/index.xql" title="Exzerpte, Notizen und Zeitungsausschnitte">
                            <h3>Exzerpte, Notizen und Zeitungsausschnitte</h3></a><!--<ul><li><a
                href="exzerpte/index.xql"
                title="Exzerpte, Notizen und Zeitungsausschnitte">Karl Marx: Exzerpte, Notizen und Zeitungsausschnitte von Oktober 1868 bis Mai 1872 (MEGA IV/19)</a></li>
        </ul>--></div>
                </div>
                <div class="container grid_8">
                    <div class="row1"><!--id="info-edition"-->
                        <h3>Zuletzt erschienen</h3>
                        <ul class="rss-feed">
                            <li class="rss-feed-item">
                                <p style="margin-bottom: 0.1em;">IV/25: Exzerpte und Notizen. 1876 bis 1879</p><!--<p style="margin-bottom: 0.1em;">Publiziert&#160;{$item/*:pubDate/data()}</p>--><!-- ##RS Hier eher das Datum in kurz Form? -->
                                <p><a href="https://megadigital.bbaw.de/exzerpte/index.xql?band=IV-25#IV-25" title="Weiterleitung zu IV/25: Exzerpte und Notizen. 1876 bis 1879"><i class="fa fa-arrow-right"></i> Anzeigen</a></p>
                            </li>
                            <li class="rss-feed-item">
                                <p style="margin-bottom: 0.1em;">IV/27: Exzerpte und Notizen. 1879 bis 1882 – Teil 2/2</p><!--<p style="margin-bottom: 0.1em;">Publiziert&#160;{$item/*:pubDate/data()}</p>--><!-- ##RS Hier eher das Datum in kurz Form? -->
                                <p><a href="https://megadigital.bbaw.de/exzerpte/index.xql?band=IV-27#IV-27" title="Weiterleitung zu IV/27: Exzerpte und Notizen. 1879 bis 1882 – Teil 2/2"><i class="fa fa-arrow-right"></i> Anzeigen</a></p>
                            </li>
                            <li class="rss-feed-item">
                                <p style="margin-bottom: 0.1em;">IV/27: Exzerpte und Notizen. 1879 bis 1882  – Teil 1/2</p><!--<p style="margin-bottom: 0.1em;">Publiziert&#160;{$item/*:pubDate/data()}</p>--><!-- ##RS Hier eher das Datum in kurz Form? -->
                                <p><a href="https://megadigital.bbaw.de/exzerpte/index.xql?band=IV-27#IV-27" title="Weiterleitung zu IV/27: Exzerpte und Notizen. 1879 bis 1882  – Teil 1/2"><i class="fa fa-arrow-right"></i> Anzeigen</a></p>
                            </li>
                            <li class="rss-feed-item">
                                <p style="margin-bottom: 0.1em;">III/16 + III/17: Briefjahrgang 1870</p><!--<p style="margin-bottom: 0.1em;">Publiziert&#160;{$item/*:pubDate/data()}</p>--><!-- ##RS Hier eher das Datum in kurz Form? -->
                                <p><a href="https://megadigital.bbaw.de/briefe/index.xql?jahr=1870" title="Weiterleitung zu III/16 + III/17: Briefjahrgang 1870"><i class="fa fa-arrow-right"></i> Anzeigen</a></p>
                            </li>
                        </ul>
                        <p><a href="https://megadigital.bbaw.de/rss/mega-rss.xml" target="_blank"><i class="fa fa-rss" aria-hidden="true"></i> RSS-Feed</a></p>
                    </div>
                    <div class="row1"><!--id="info-edition"-->
                        <h3>Über diese Edition</h3>
                        <p class="border">Die Marx-Engels-Gesamtausgabe (<abbr title="Marx-Engels-Gesamtausgabe">MEGA</abbr>) präsentiert die
        Veröffentlichungen, Manuskripte und den Briefwechsel von Marx und Engels in vier Abteilungen. Die I. Abteilung (Werke)
        erscheint ausschließlich im <a href="https://mega.bbaw.de/de/mega-baende/i-abteilung" title="Überblick über die I. Abteilung der MEGA">Druck</a>.
        Aus der II. Abteilung („‚Das Kapital‘ und Vorarbeiten“) sind die edierten Texte von zehn Bänden mit den
        <a href="http://telota.bbaw.de/mega/" title="Online verfügbare Inhalte der II. Abteilung">wichtigsten Textfassungen und Manuskripten
        zum „Kapital“</a> auf MEGAdigital abrufbar. Die III. Abteilung (Briefe) liegt bis zum Jahrgang 1865 in Form von Druckbänden vor.
        Ab dem Jahrgang 1866 werden die <a href="briefe/index.xql" title="Übersicht aller online verfügbaren Briefe">Briefe von und an Marx und Engels</a>
        ebenfalls auf MEGAdigital dargeboten. Dies gilt auch für einen Großteil der <a href="exzerpte/index.xql">Exzerpte und Notizen</a> (IV. Abteilung).</p>
                        <p><a href="about/text.xql?id=M0001265">Mehr zu dieser Edition</a></p>
                    </div>
                </div>
                <div class="container grid_4">
                    <div class="row1"><!--id="search"-->
                        <h3>Suche</h3>
                        <form id="search" action="https://megadigital.bbaw.de/suche/index.xql"><input name="q" id="q" value="" placeholder="Suchbegriff" autofocus><select name="type">
                                <option value="all">Alles</option>
                                <option value="letter">Brief</option>
                                <option value="excerpt">Exzerpt</option>
                                <option value="intro">Einführungen &amp; Textgeschichten</option>
                                <option value="registry">Register</option></select><button class="submit" type="submit"><i class="fa fa-search"></i> Suchen</button><br></form>
                        <p><a href="suche/index.xql">[Erweiterte Suche]</a></p><!-- <span class="icon-question-sign help">
                            <span class="helpcontent">
                                Sie können verschiedene Zeichen in Ihrer Suchabfrage nutzen:
                                <ul>
                                    <li>* (Stern): Trunkieren</li>
                                    <li>~ (Tilde): Unscharfe Suche</li>
                                    <li>"" (Anführungszeichen): Genaue Phrase</li>
                                </ul>
                            </span>
                        </span> -->
                    </div>
                    <div class="row1"><!--id="further-texts"-->
                        <h3>Weitere Materialien und Texte</h3>
                        <ul class="outer">
                            <li>Feuerbach-Thesen:</li>
                            <ul class="sub-list">
                                <li><a href="https://edoc.bbaw.de/frontdoor/index/index/docId/1412" title="Die Feuerbach-Thesen auf dem edoc-Server der BBAW">Karl Marx 1845: "1) ad Feuerbach"</a></li>
                                <li><a href="https://edoc.bbaw.de/frontdoor/index/index/docId/1413" title="Karl Marx über Feuerbach auf dem edoc-Server der BBAW">"Karl Marx über Feuerbach": Version von F. Engels von 1888</a></li>
                            </ul>
                            <li><a href="http://www.deutschestextarchiv.de/nrhz" title="Die „Neue Rheinische Zeitung“ im Deutschen Textarchiv">Vollständige Leseausgabe „Neue Rheinische Zeitung“</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="outerLayer" id="footer">
            <footer class="container_12">
                <div class="grid_4">
                    <ul>
                        <h3>Über das Vorhaben</h3>
                        <li><a href="http://www.bbaw.de/forschung/mega">Vorhaben</a></li>
                        <li><a href="https://megadigital.bbaw.de/impressum.xql">Impressum &amp; Datenschutz</a></li>
                        <li><a href="mailto:roth@bbaw.de?subject=MEGAdigital">Kontakt</a></li>
                    </ul>
                    <p style="margin-top: 2em;">
                            	Digitale Konzeption und Realisierung: <br>
                        <h3 style="margin-top: .5em;"><a href="http://www.bbaw.de/telota/telota">TELOTA - The Electronic Life of the Academy (TELOTA - IT/DH)</a></h3>
                    </p>
                </div>
                <div class="grid_4">
                    <h3><a href="https://mega.bbaw.de/de/imes">Herausgegeben von der Internationalen Marx-Engels-Stiftung</a></h3>
                    <p>Das Akademienvorhaben „Marx-Engels-Gesamtausgabe“ ist Teil des von Bund und Ländern geförderten <a href="http://www.akademienunion.de/forschung/akademienprogramm/">Akademienprogramms</a>, das der Erhaltung, Sicherung und Vergegenwärtigung des kulturellen Erbes dient. Koordiniert wird das Programm von der <a href="http://www.akademienunion.de/akademienunion/ueber-uns/">Union der Deutschen Akademien der Wissenschaften</a>.</p>
                    <p style="clear:both;"><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"></a><br>Dieses Werk ist lizenziert unter einer <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Namensnennung - Nicht-kommerziell - Weitergabe unter gleichen Bedingungen 4.0 International Lizenz</a>.</p>
                </div>
                <div class="grid_4">
                    <p><a style="float:right;" href="http://www.bbaw.de"><img src="https://megadigital.bbaw.de/resources/images/bbaw_logo.png" title="Berlin-Brandeburgische Akademie der Wissenschaften" alt="Das Logo der Berlin-Brandenburgischen Akademie der Wissenschaften zeigt den Schriftzug neben einem Adler vor einem Sternenhimmel"></a></p>
                </div>
            </footer>
        </div>
        <script type="text/javascript">
                    // The tooltipsObserver is used to keep track of the visibility of elements showing tooltips
                    const tooltipsObserver = new IntersectionObserver((tooltips, observer) => {
                        tooltips.forEach(element => {
                            if(element.isIntersecting) {
                                //console.log("In viewport");
                            } else {
                                if (element.intersectionRatio == 0.0) {
                                    //console.log("Out of viewport");
                                    tooltipsObserver.disconnect();
                                    $(".active .fussnote").hide();
                                    $(".active").removeClass('active');
                                    $(".highlighted-newspaper").removeClass("highlighted-newspaper");
                                    $(".highlighted-excerpt").removeClass("highlighted-excerpt");
                                    $("#box-toc").removeClass("disabled-toc-box");
                                }
                            }
                        });
                    }, {});
                    
                    $('.tooltip').not('.add').not('.measure').mouseover(function(){
                    
                        //If this item is already selected, forget about it.
                        if ($(this).hasClass('active')) return;
                        
                        //Find the currently selected item and hide it, then and remove the style class 'active'
                        $('.highlighted-newspaper').removeClass('highlighted-newspaper');
                        $(".highlighted-excerpt").removeClass("highlighted-excerpt");
                        $(".active .fussnote").hide();
                        $('.active').removeClass('active');
                        
                        //Add the style class 'active' to this item, then show it
                        $(this).addClass('active');
                        $(".active .fussnote").show();
                        $("#box-toc").addClass("disabled-toc-box");
                        if ($(this).hasClass("excerpt_source")) {
                            $(".highlighted-excerpt").removeClass("highlighted-excerpt");
                            $(this).parent("div, p, ul, ol").addClass("highlighted-excerpt");
                            $(this).parents("table").addClass("highlighted-excerpt");
                            }
                        if ($(this).hasClass("newspaper-img")) {
                            $('.highlighted-newspaper').removeClass('highlighted-newspaper');
                            $(this).parent('div, p, ul, ol, table').addClass('highlighted-newspaper');
                            }
                        tooltipsObserver.disconnect();
                        tooltipsObserver.observe($(".highlighted-excerpt, .highlighted-newspaper, .active")[0]);
                    });
                    
                    $('.close').click(function(){
                        $(".active .fussnote").hide();
                        $(".active").removeClass("active");
                        $(".highlighted-excerpt").removeClass("highlighted-excerpt");
                        $(".highlighted-newspaper").removeClass("highlighted-newspaper");
                        $("#box-toc").removeClass("disabled-toc-box");
                    });
                    
                    
                    // Marginalien/Randanstreichungen
                    
                    function drawMarginals(withoutUnderlines) {
                    console.log("Drawing Marginals (Randanstreichungen)")
                    // Simple data class for marginals data
                        class marginal {
                            color;
                            type;
                            x;
                            y;
                            height;
                            ref_id;
                            constructor(data) {
                                Object.assign(this, data);
                            }
                        }
                        
                        // Create basic SVG for marginals (if not already existing)
                        
                        if (!$("#svg_marginals").length) {
                            $("body").prepend("<div id='svg_container'>");
                            $("#svg_container").prepend("<svg id='svg_exclamation-mark' style='z-index:100;'height='20' width='20' viewbox='120 0 50 300'><title>Randanstreichung</title><g fill='transparent'><polygon points='119.151,0 129.6,218.406 172.06,218.406 182.54,0'/><rect x='130.563' y='261.168' width='40.525' height='40.523'/></g></svg>");
                            $("#svg_container").prepend("<svg id='svg_marx-sign' style='z-index:100;'height='20' width='20' viewBox='211.71 100 88.29 100' width='88.29' height='100' preserveAspectRatio='none'><title>Randanstreichung</title><path style='stroke: rgb(0, 0, 0); fill: none; stroke-linecap: round; stroke-linejoin: round; stroke-width: 12px;' d='M 211.71 200 L 231.163 158.045 L 256.206 100 L 300 200' transform='matrix(1, 0, 0, 1, 0, -1.4210854715202004e-14)'/><path style='fill: rgb(216, 216, 216); stroke: rgb(0, 0, 0); stroke-linecap: round; stroke-width: 10px;' d='M 211.71 100 L 300 100' transform='matrix(1, 0, 0, 1, 0, -1.4210854715202004e-14)'/></svg>");
                            $("#svg_container").prepend("<svg id='svg_marginals' style='overflow: visible; position: absolute; z-index:100;'><defs><pattern id='svg_cross' width='1' height='.02'><path stroke-width='2' stroke='red' d='m6,6l8,8m0,-8l-8,8'/></pattern></defs><line stroke-width='3px' id='svg_line'><title>Randanstreichung</title></line><rect fill='url(#svg_cross)' id='svg_cross_line'><title>Randanstreichung</title></rect></svg>");
                            
                        }
                        
                        // Get left position (i. e. "x") once - its the same for the whole transcription
                        const leftmargin = $(".transkription").offset().left;
                        var id_counter = 0;

                        // Process all class="marginal-start" elements for marginals, i. e. _not_ underlines
                        $("span.marginal-start:not(.underline)").each(function () {
                            let marginals = [];
                            let x_pos = leftmargin;
                            let ref_id = $(this).attr("id");
                            rendition = $(this).attr("data-rendition").split(" ", 3);

                            // Compute rendition coordinate/height values for marginals
                            for (i = 0; i < rendition.length; i++) {
                                let correspID = "#" + $(this).attr("data-corresp");
                                let color = rendition[i].split("_", 2)[0];
                                let type = rendition[i].split("_", 2)[1];
                                let y = $(this).offset().top;
                                
                                if (i === 0 && type == "cross") {
                                    x_pos = x_pos - 20;
                                }

                                if (i > 0) {
                                    if (type == "solid") {
                                        x_pos = x_pos - 4;
                                    }
                                    else if (type == "cross") {
                                        x_pos = x_pos - 20;
                                    }
                                }

                                let x = x_pos;
                                // Check if element with height could be calculated, otherwise skip this marginal
                                try {
                                    var height = $(correspID).offset().top - y;

                                    // It's visually nicer, to include half the bottom margin and padding if the end-span is in a heading
                                    let heightHeader = 0;
                                    if ($(correspID).closest(":header").length > 0) {
                                        heightHeader = ((parseInt($(correspID).closest(":header").css("margin-bottom")) || 0 ) + (parseInt($(correspID).closest(":header").css("padding-bottom")) || 0)) / 2;
                                        }
                                    height = height + heightHeader + $(correspID).height(); // Add height and padding of line with end-span
                                }
                                catch (err) {
                                    console.log("Error drawing marginal");
                                }
                                marginals.push(new marginal({ color, type, x, y, height, ref_id }));
                            }

                            //console.log(marginals)

                            // Draw marginals
                            marginals.forEach((element) => {
                                //console.log(element)
                                if (element.type == "solid") {
                                    $("#svg_line")
                                        .clone()
                                        .removeAttr("id")
                                        .attr("class", "svg_clone")
                                        .attr("x1", element.x)
                                        .attr("y1", element.y)
                                        .attr("x2", element.x)
                                        .attr("y2", element.y + element.height)
                                        .attr("stroke", element.color)
                                        .insertAfter($("#svg_line"));
                                }
                                else if (element.type == "cross") {
                                    // Copy and prepare cross pattern
                                    let new_id = "svg_cross" + id_counter;
                                    $("#svg_cross")
                                        .clone()
                                        .attr("class", "svg_clone")
                                        .attr("id", new_id)
                                        .insertAfter($("#svg_cross"));

                                    // Set height for new "cross" pattern
                                    $("#" + new_id).attr("height", 16 / element.height.toFixed(2));

                                    // Set pattern color $("#svg_cross > path").attr("stroke", "blue")
                                    $("#" + new_id + "> path").attr("stroke", element.color);

                                    // Clone and assign new ID for fill="url(#ID)"
                                    $("#svg_cross_line")
                                        .clone()
                                        .removeAttr("id")
                                        .attr("class", "svg_clone")
                                        .attr("fill", "url(#" + new_id + ")")
                                        .attr("x", element.x)
                                        .attr("y", element.y)
                                        .attr("height", element.height)
                                        .attr("width", "16")
                                        .insertAfter($("#svg_cross_line"));
                                    id_counter++;
                                }
                                else if (element.type == "exclamation-mark"){
                                    //console.log("Drawing exclamation-mark");
                                    let new_id = "svg_exclamation-mark" + id_counter;
                                    $("#svg_exclamation-mark")
                                        .clone()
                                        .attr("class", "svg_clone")
                                        .attr("id", new_id)
                                        .insertAfter($("#svg_exclamation-mark"));
                                    $("#" + new_id).attr("height", element.height);
                                    $("#" + new_id + " g").attr("fill", "#000000");
                                    $("#" + new_id).position({my: "top right", at: "left top", of: "#" + element.ref_id});
                                    $("#" + new_id).css("left", leftmargin-95); // 95 is a magic value here, it just works :-|
                                    $("#" + new_id).css("top", "+=19"); // 13 is a magic value here, should be around the 1.5x line height
                                    
                                }
                                else if (element.type == "marx-sign"){
                                    //console.log("Drawing marx-sign");
                                    let new_id = "svg_marx-sign" + id_counter;
                                    $("#svg_marx-sign")
                                        .clone()
                                        .attr("class", "svg_clone")
                                        .attr("id", new_id)
                                        .insertAfter($("#svg_marx-sign"));
                                    $("#" + new_id).attr("height", element.height);
                                    $("#" + new_id).position({my: "top right", at: "left top", of: "#" + element.ref_id});
                                    $("#" + new_id).css("left", leftmargin-45); // 45 is a magic value here, it just works :-|
                                    $("#" + new_id).css("top", "+=39"); // 39 is a magic value here, should be around 1.5x the line height
                                }
                            });
                        });

                        // Underlines don't need to be redrawn, hence we return early in this case
                        if (withoutUnderlines) {
                            console.log("Not drawing underlines");
                            return;
                        }
                        // Process all class="marginal-start underline" elements
                        $("span.marginal-start.underline").each(function () {
                            let rendition = $(this).attr("data-rendition");
                            if (!rendition.match("double-underline")) {
                                // Check if next node really is of class ".marginal-end" and only text follows the current node
                                if ($(this).next().hasClass("marginal-end") && $(this)[0].nextSibling.nodeType === Node.TEXT_NODE) {
                                    let text = $(this)[0].nextSibling.nodeValue;
                                    let color = rendition.split("_")[0]  // The color for a simple underline is the first value of the rendition value, i. e. "COLOR_underline"
                                    $(this)[0].nextSibling.remove();
                                    $(this).after(`<span class='unterstrichen ${color}'>`); 
                                    $(this).next().text(text);
                                }
                                else {
                                    // Copy all elements between this start element end the corresponding end element
                                    // console.log(`Underlines nested: ${$(this)[0].id}`);
                                    // console.log($(this));
                                    let color = rendition.split("_")[0];  // The color for a simple underline is the first value of the rendition value, i. e. "COLOR_underline"
                                    let endId = $(this).data('corresp');
                                    let indexStart = $(this).parent().contents().index($(this));
                                    let indexEnd = $(this).parent().contents().index($(`#${endId}`));
                                    let elementsToMove = $(this).parent().contents().slice(indexStart+1, indexEnd);
                                    // console.log(elementsToMove);
                                    $(this).after(`<span class='doppeltunterstrichen_base doppeltunterstrichen_bunt_${color}'>`);
                                    $(this).next().append(elementsToMove);
                                }
                            }
                            else {
                                // console.log($(this));
                                // console.log("double-underline");
                                if ($(this).next().hasClass("marginal-end") && $(this)[0].nextSibling.nodeType === Node.TEXT_NODE) {
                                    // console.log(`Underlines _not_nested: ${$(this)[0].id}`);
                                    let text = $(this)[0].nextSibling.nodeValue;
                                    let colors = rendition.split("_")[0]  // The color for a simple underline is the first value of the rendition value, i. e. "COLOR_underline"
                                    let first_color = colors.split("-")[0]
                                    let second_color = colors.split("-")[1]
                                    $(this)[0].nextSibling.remove();
                                    $(this).after(`<span class='unterstrichen_${first_color} doppeltunterstrichen_base doppeltunterstrichen_bunt_${second_color}'>`); 
                                    $(this).next().text(text);
                                }
                                else {
                                    // Copy all elements between this start element end the corresponding end element
                                    // console.log(`Underlines nested: ${$(this)[0].id}`);
                                    // console.log($(this));
                                    let colors = rendition.split("_")[0]  // The color for a simple underline is the first value of the rendition value, i. e. "COLOR_underline"
                                    let first_color = colors.split("-")[0]
                                    let second_color = colors.split("-")[1]
                                    let endId = $(this).data('corresp');
                                    let indexStart = $(this).parent().contents().index($(this));
                                    let indexEnd = $(this).parent().contents().index($(`#${endId}`));
                                    let elementsToMove = $(this).parent().contents().slice(indexStart+1, indexEnd);
                                    // console.log(elementsToMove);
                                    $(this).after(`<span class='unterstrichen_${first_color} doppeltunterstrichen_base doppeltunterstrichen_bunt_${second_color}'>`); 
                                    $(this).next().append(elementsToMove);
                                }
                            }
                        });
                    }

                    // Draw marginals after a short pause, because the site needs to be fully loaded in order to draw them correctly
                    $(window).ready(function() {
                    setTimeout(drawMarginals(), 1000);
                    });
                        
                    // On Resize or Zoom all marginals must be redrawn
                    $(window).resize(function () {
                        $(".svg_clone").remove();
                        // Underlines don't need to be redrawn
                        var withoutUnderlines = true;
                        drawMarginals(withoutUnderlines);
                    });
                </script>
        <script type="text/javascript">
                    $(document).on('click', '.toggle', function(evt){
                        var elem = $(evt.target);
                        var nextUl = elem.closest('.toc-entry-title').nextAll('ul').eq(0);
                        if (nextUl.hasClass('visible')){
                            elem.removeClass('fa-chevron-circle-down').addClass('fa-chevron-circle-right');
                            nextUl.removeClass('visible').addClass('invisible');
                        } else {
                            elem.removeClass('fa-chevron-circle-right').addClass('fa-chevron-circle-down');
                            nextUl.removeClass('invisible').addClass('visible');
                        }
                    });
                    
                    function expandTocItem(tocItem){
                        $('.current').removeClass('current');
                        tocItem.closest('.toc-entry-title').addClass('current');
                        $("nav a:contains('Exzerpte')").addClass('current');
                        tocItem.parents('ul').each(function(){
                        var ul = $(this);
                        ul.removeClass('invisible').addClass('visible');
                        ul.prevAll('.toc-entry-title')
                        .find('.fa')
                        .removeClass('fa-chevron-circle-right').addClass('fa-chevron-circle-down');
                        });
                    
                    };
                    
                    $(function() {
                        if (window.location.hash){
                        var tocItemSelector = window.location.hash.replace('#', '#toc').split('.').join('\\.');
                        var tocItem = $(tocItemSelector);
                        expandTocItem(tocItem);   
                        };
                        $(document).on('click', '.toc-entry-title', function(evt){ expandTocItem($(evt.target)); });
                        
                    });
                </script>
        <script>
                    $(document).ready(function(){
                    $('.collapsedNote').collapser({
                    mode: 'block',
                    target: 'next',
                    speed: 'fast',
                    blockEffect: 'fade'
                    });
                    });
                    
                </script>
    </body>
</html>